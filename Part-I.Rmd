---
title: "Part-I-Writeup"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
suppressMessages(library(ISLR))
suppressMessages(library(arm))
suppressMessages(library(ggplot2))
suppressMessages(library(tidyverse))
suppressMessages(library(GGally))
library(knitr)
library(BAS)
```

### EDA final version

```{r}
# merge the two dataset first
paint <- rbind(paintings_train, paintings_test)
# Fix position > 1
paint$position[paint$position > 1] <- paint$position[paint$position > 1]/100
# regroup some categorical variables
paint <- paint %>%
  mutate(winningbiddertype = as.factor(dplyr::recode(na_if(winningbiddertype,""),
                                                     .missing = 'U')),
         endbuyer = as.factor(dplyr::recode(na_if(endbuyer,""),
                                            .missing = 'U')),
         Interm = as.factor(dplyr::recode(Interm,
                                          .missing = 0,
                                          `0` = 0,
                                          `1` = 1)), 
         authorstyle = as.factor(dplyr::recode(authorstyle,
                                               'n/a' = 'No Info',
                                               .default = 'With Info')),
         type_intermed = as.factor(dplyr::recode(na_if(type_intermed,''),
                                                 .missing='Unknown')),
         Shape = as.factor(dplyr::recode(na_if(Shape,""),
                                         .missing = 'Unknown',
                                         'squ_rect' = 'squ_rect',
                                         .default = 'other')),
         materialCat = as.factor(dplyr::recode(na_if(materialCat,""),
                                               .missing = 'Unknown')),
         nfigures = as.factor(dplyr::recode(nfigures,
                                            `0`= 0,
                                            .default = 1))
  ) %>% 
  # change variables into appropriate format
  mutate_at(vars(dealer, origin_author, origin_cat, school_pntg, 
                 diff_origin, artistliving, authorstandard, authorstyle, 
                 winningbiddertype, endbuyer, Interm, type_intermed, 
                 material, mat, materialCat, Shape, engraved, original, 
                 prevcoll, othartist, paired, figures, finished, lrgfont, 
                 relig, landsALL, lands_sc, lands_elem, lands_figs, lands_ment, 
                 arch, mytho, peasant, othgenre, singlefig, portrait, 
                 still_life, discauth, history, allegory, pastorale,other), as.factor) %>% 
  mutate_at(vars(price), as.numeric) 
# delete unnecessary variables
paint <- paint %>% 
  dplyr::select(-c("sale", "lot", "diff_origin", "count","subject", "author", "authorstandard","winningbidder","other","pastorale","allegory","history", "lands_ment","original", "type_intermed","origin_author","material","mat","figures","singlefig","Diam_in","Surface_Rnd","Surface_Rect","Width_in","Height_in"))
summary(paint)
#notice some NAs and 0s in Surface variable, needs to impute them with median
paint <- paint%>% mutate(Surface = dplyr::recode(Surface,.missing = 270.4))
paint$Surface[paint$Surface==0] <- 270.4
summary(paint)
paint_train <- paint%>%filter(!is.na(logprice))
paint_test <-paint%>%filter(is.na(logprice))
dim(paint_train)
```

# variables selection and model selection
```{r build model, cache=T}
paint_train_trans <- paint_train%>% select(-c(othartist,mytho,relig, landsALL))%>%
  mutate(Surface = log(Surface))
model0 <- lm(logprice~(.), data=paint_train_trans)
n = nrow(paint_train_trans)
#use bic to select the variables 
step(model0,k=log(n),trace = F)
#model without interaction
model1 <- lm(formula = logprice ~ (dealer + year + origin_cat + artistliving +authorstyle + 
                                     endbuyer + Interm + Surface + engraved + prevcoll + 
                                     paired + finished + lrgfont + lands_sc + discauth), 
             data = paint_train_trans)
#prepare for BIC
#model2 <- lm(formula = logprice ~ (dealer + year + origin_cat + artistliving +authorstyle + endbuyer + Interm + Surface + engraved + prevcoll + 
#    paired + finished + lrgfont + lands_sc + discauth)^2, data = #paint_train_trans)
#use this step to have a look :step(model2, k = 2, trace = F)
#the following model is modified based on BIC selection, I deleted some interactions, feel free to check whether the interaction make sense
finalmodel <- lm(formula = logprice ~ dealer + year + origin_cat + artistliving + 
    authorstyle + endbuyer + Interm + Surface + engraved + prevcoll + 
    paired + finished + lrgfont + lands_sc + discauth + dealer:year + 
    + dealer:Interm + dealer:discauth + year:artistliving + year:endbuyer + year:Surface+ year:discauth+ artistliving:authorstyle + artistliving:lands_sc + artistliving:discauth + authorstyle:Surface + endbuyer:finished + 
    endbuyer:discauth + Interm:Surface + Interm:prevcoll + Interm:lrgfont + 
    Interm:discauth + Surface:discauth + prevcoll:finished + 
    paired:finished + paired:lrgfont + paired:lands_sc + paired:discauth + 
    lands_sc:discauth, data = paint_train_trans)
summary(finalmodel)
```

# finalmodel deleted some interactions
```{r}
finalmodel <- lm(formula = logprice ~ dealer + year + origin_cat + artistliving + 
    authorstyle + endbuyer + Interm + Surface + engraved + prevcoll + 
    paired + finished + lrgfont + lands_sc + discauth + dealer:year + 
    + dealer:Interm + dealer:discauth + year:artistliving + year:endbuyer + year:Surface+ year:discauth+ artistliving:authorstyle + artistliving:discauth + authorstyle:Surface + endbuyer:finished + endbuyer:discauth + Interm:Surface + Interm:prevcoll + Interm:lrgfont + 
    Interm:discauth + Surface:discauth + prevcoll:finished + 
    paired:finished + paired:lrgfont + paired:discauth, data = paint_train_trans)
summary(finalmodel)
```

I deleted the interactions `lands_sc:discauth`, `paired:lands_sc` and `artistliving:lands_sc`. First of all, for the interactions related to `lands_sc`, we think the `lands_sc`--if described as a plain landscape, is a variable describing a single dimension of painting content and we don't think it will interact with the variables describing the dealers' behaviour, the pairing of a painting, or the living info of the artists. Though the Adjusted R-squared decreased a little, from 0.66 to 0.659, we think it worth to make the model more reasonable.

